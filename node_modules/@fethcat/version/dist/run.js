"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.run = void 0;
const config_1 = require("./config");
const exit_1 = require("./exit");
const release_1 = require("./release");
const version_1 = require("./version");
function invalidArg(type, value, values) {
    return `Invalid ${type} "${value}", should be one of: ${values.join(',')}`;
}
async function run(argv) {
    const [command] = argv;
    if (command === 'release') {
        // E.g version release qa
        const [, env, codeVersion] = argv;
        if (!config_1.envs.includes(env)) {
            return (0, exit_1.exitOnError)(invalidArg('environment', env, config_1.envs));
        }
        await (0, release_1.release)(env, codeVersion).catch((error) => {
            (0, exit_1.exitOnError)(error.message);
        });
    }
    else {
        // E.g version patch
        const [level, ...dirs] = argv;
        if (!config_1.versionLevel.includes(level)) {
            return (0, exit_1.exitOnError)(invalidArg('version level', level, config_1.versionLevel));
        }
        await (0, version_1.version)(level, dirs).catch((error) => {
            (0, exit_1.exitOnError)(error.message);
        });
    }
}
exports.run = run;
